<?php
// –ü–æ–¥–∫–ª—é—á–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
require_once 'conf.php';

// –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
try {
    $pdo = new PDO("mysql:host=$DB_HOSTNAME;dbname=$DB_NAME;charset=utf8", $DB_USERNAME, $DB_PASSWORD);
    $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
    echo "‚úÖ –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ.<br>";
} catch (PDOException $e) {
    die("‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö: " . $e->getMessage());
}

// --- –®–∞–≥ 1: –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–π –∫–æ–ª–æ–Ω–∫–∏ 'expliq', –µ—Å–ª–∏ –æ–Ω–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç ---
try {
    $checkColumn = $pdo->query("SHOW COLUMNS FROM `GSDatabase` LIKE 'expliq'");
    if ($checkColumn->rowCount() > 0) {
        $pdo->exec("ALTER TABLE GSDatabase DROP COLUMN expliq");
        echo "‚úÖ –°—Ç–∞—Ä–∞—è –∫–æ–ª–æ–Ω–∫–∞ 'expliq' —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–∞.<br>";
    } else {
        echo "‚ÑπÔ∏è –ö–æ–ª–æ–Ω–∫–∞ 'expliq' –Ω–µ –Ω–∞–π–¥–µ–Ω–∞, —É–¥–∞–ª–µ–Ω–∏–µ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è.<br>";
    }
} catch (PDOException $e) {
    die("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∫–æ–ª–æ–Ω–∫–∏: " . $e->getMessage());
}

// --- –®–∞–≥ 2: –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –∫–æ–ª–æ–Ω–∫–∏ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –º–µ—Å—Ç–µ ---
try {
    // –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–ª–æ–Ω–∫—É expliq –ü–û–°–õ–ï –∫–æ–ª–æ–Ω–∫–∏ answer
    $pdo->exec("ALTER TABLE GSDatabase ADD COLUMN expliq TEXT NULL DEFAULT NULL AFTER qtype");
    echo "‚úÖ –ù–æ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ 'expliq' —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–∞ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏ (–ø–æ—Å–ª–µ 'answer').<br>";
} catch (PDOException $e) {
    die("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –Ω–æ–≤–æ–π –∫–æ–ª–æ–Ω–∫–∏: " . $e->getMessage());
}

// --- –®–∞–≥ 3: –ß—Ç–µ–Ω–∏–µ CSV-—Ñ–∞–π–ª–∞ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (—Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–µ–º) ---
$csvFile = 'Module 2 FINAL(1).csv';
$startId = 23;
$endId = 51;
$currentId = $startId;

if (!file_exists($csvFile)) {
    die("‚ùå –û—à–∏–±–∫–∞: CSV-—Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω –ø–æ –ø—É—Ç–∏: " . $csvFile);
}

// –û—Ç–∫—Ä—ã–≤–∞–µ–º CSV-—Ñ–∞–π–ª –¥–ª—è —á—Ç–µ–Ω–∏—è
if (($handle = fopen($csvFile, "r")) !== FALSE) {
    $updateQuery = $pdo->prepare("UPDATE GSDatabase SET expliq = ? WHERE id = ?");

    // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –ø–µ—Ä–≤—É—é —Å—Ç—Ä–æ–∫—É —Å –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏
    fgetcsv($handle);

    echo "üöÄ –ù–∞—á–∏–Ω–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ –Ω–æ–≤–æ–π –∫–æ–ª–æ–Ω–∫–µ...<br>";

    // –ß–∏—Ç–∞–µ–º CSV-—Ñ–∞–π–ª –ø–æ—Å—Ç—Ä–æ—á–Ω–æ, –∏—Å–ø–æ–ª—å–∑—É—è —Ç–æ—á–∫—É —Å –∑–∞–ø—è—Ç–æ–π (;) –∫–∞–∫ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å
    while (($data = fgetcsv($handle, 2000, ";")) !== FALSE && $currentId <= $endId) {
        // –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ –≤ —Å—Ç—Ä–æ–∫–µ –µ—Å—Ç—å 11-–π —ç–ª–µ–º–µ–Ω—Ç (–∏–Ω–¥–µ–∫—Å 10) –∏ –æ–Ω –Ω–µ –ø—É—Å—Ç–æ–π
        if (isset($data[10]) && !empty(trim($data[10]))) {
            $explanation = trim($data[10]);
            
            // –í—ã–ø–æ–ª–Ω—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
            $updateQuery->execute([$explanation, $currentId]);
            echo "‚úîÔ∏è ID: $currentId - –î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∑–∞–ø–∏—Å–∞–Ω—ã.<br>";

            $currentId++;
        } else {
            // –ï—Å–ª–∏ —Å—Ç—Ä–æ–∫–∞ –≤ CSV –ø—É—Å—Ç–∞—è, –ø—Ä–æ—Å—Ç–æ –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –µ–µ, –Ω–æ ID —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º
             echo "‚ö†Ô∏è ID: $currentId - –ü—Ä–æ–ø—É—â–µ–Ω–∞ –ø—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞ –≤ CSV.<br>";
             $currentId++;
        }
    }
    fclose($handle);
    echo "üéâ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–æ.<br>";
} else {
    echo "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–∫—Ä—ã—Ç—å CSV-—Ñ–∞–π–ª –¥–ª—è —á—Ç–µ–Ω–∏—è.";
}

?>
