<?php
// –ü–æ–¥–∫–ª—é—á–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
require_once 'conf.php';

// –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
try {
    $pdo = new PDO("mysql:host=$DB_HOSTNAME;dbname=$DB_NAME;charset=utf8", $DB_USERNAME, $DB_PASSWORD);
    $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
    echo "‚úÖ –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ.<br>";
} catch (PDOException $e) {
    // –í —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏ –≤—ã–≤–æ–¥–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ –∏ –ø—Ä–µ–∫—Ä–∞—â–∞–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
    die("‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö: " . $e->getMessage());
}

// --- –®–∞–≥ 1: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–ª–æ–Ω–∫–∏ 'expliq', –µ—Å–ª–∏ –æ–Ω–∞ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç ---
try {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —É–∂–µ —Ç–∞–∫–∞—è –∫–æ–ª–æ–Ω–∫–∞
    $checkColumn = $pdo->query("SHOW COLUMNS FROM `GSDatabase` LIKE 'expliq'");
    
    if ($checkColumn->rowCount() == 0) {
        // –ï—Å–ª–∏ –∫–æ–ª–æ–Ω–∫–∏ –Ω–µ—Ç, –¥–æ–±–∞–≤–ª—è–µ–º –µ—ë
        $pdo->exec("ALTER TABLE GSDatabase ADD COLUMN expliq TEXT NULL DEFAULT NULL AFTER answer");
        echo "‚úÖ –ö–æ–ª–æ–Ω–∫–∞ 'expliq' —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ —Ç–∞–±–ª–∏—Ü—É GSDatabase.<br>";
    } else {
        echo "‚ÑπÔ∏è –ö–æ–ª–æ–Ω–∫–∞ 'expliq' —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ —Ç–∞–±–ª–∏—Ü–µ.<br>";
    }
} catch (PDOException $e) {
    die("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –∫–æ–ª–æ–Ω–∫–∏: " . $e->getMessage());
}

// --- –®–∞–≥ 2: –ß—Ç–µ–Ω–∏–µ CSV-—Ñ–∞–π–ª–∞ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö ---
$csvFile = 'Module 2 FINAL(1).csv';
$startId = 23;
$endId = 51;
$currentId = $startId;

// –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ CSV-—Ñ–∞–π–ª
if (!file_exists($csvFile)) {
    die("‚ùå –û—à–∏–±–∫–∞: CSV-—Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω –ø–æ –ø—É—Ç–∏: " . $csvFile);
}

// –û—Ç–∫—Ä—ã–≤–∞–µ–º CSV-—Ñ–∞–π–ª –¥–ª—è —á—Ç–µ–Ω–∏—è
if (($handle = fopen($csvFile, "r")) !== FALSE) {
    // –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º SQL-–∑–∞–ø—Ä–æ—Å –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
    $updateQuery = $pdo->prepare("UPDATE GSDatabase SET expliq = ? WHERE id = ?");

    // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –ø–µ—Ä–≤—É—é —Å—Ç—Ä–æ–∫—É —Å –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏ –≤ CSV
    fgetcsv($handle, 2000, ",");

    echo "üöÄ –ù–∞—á–∏–Ω–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π...<br>";

    // –ß–∏—Ç–∞–µ–º CSV-—Ñ–∞–π–ª –ø–æ—Å—Ç—Ä–æ—á–Ω–æ
    while (($data = fgetcsv($handle, 2000, ",")) !== FALSE && $currentId <= $endId) {
        // –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ –≤ —Å—Ç—Ä–æ–∫–µ –µ—Å—Ç—å 11-–π —ç–ª–µ–º–µ–Ω—Ç (–∏–Ω–¥–µ–∫—Å 10)
        if (isset($data[10])) {
            $explanation = trim($data[10]);

            // –í—ã–ø–æ–ª–Ω—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
            $updateQuery->execute([$explanation, $currentId]);
            echo "‚úîÔ∏è –û–±–Ω–æ–≤–ª–µ–Ω–∞ –∑–∞–ø–∏—Å—å —Å ID: $currentId.<br>";

            // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É ID
            $currentId++;
        }
    }
    fclose($handle);
    echo "üéâ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–æ.<br>";
} else {
    echo "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–∫—Ä—ã—Ç—å CSV-—Ñ–∞–π–ª –¥–ª—è —á—Ç–µ–Ω–∏—è.";
}
?>
